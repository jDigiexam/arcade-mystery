<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Over at Ace's Arcade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        
        body {
            font-family: 'VT323', monospace;
            background-image: url('https://raw.githubusercontent.com/jDigiexam/halloween2025/main/arcade%20floor.jpg');
            background-color: #0d0d0d; /* Fallback color */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #e0e0e0;
            font-size: 1.1rem;
            line-height: 1.6;
            transition: background-image 1s ease-in-out; /* Smooth background transition */
        }

        .font-pixel {
            font-family: 'VT323', monospace;
        }

        .view {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .btn-mystery {
            @apply bg-fuchsia-600/80 text-white font-bold py-3 px-6 rounded-md shadow-lg hover:bg-fuchsia-500 transition-all duration-300 ease-in-out cursor-pointer text-center border-2 border-fuchsia-400;
            text-shadow: 0 0 5px #fuchsia-300;
        }

        .btn-mystery-sm {
            @apply bg-cyan-700/80 text-white font-bold py-2 px-4 rounded-md shadow-md hover:bg-cyan-600 transition-all duration-300 ease-in-out cursor-pointer text-center border-2 border-cyan-500;
            text-shadow: 0 0 5px #cyan-300;
        }
        
        .btn-disabled {
            @apply bg-gray-700 text-gray-400 font-bold py-2 px-4 rounded-md shadow-md cursor-not-allowed border-2 border-gray-600;
        }

        /* Modal for final solution screen */
        .modal {
            @apply fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 transition-opacity duration-300;
        }
        
        .modal-content {
            @apply bg-black/80 backdrop-blur-sm p-6 rounded-lg shadow-2xl max-w-sm w-full text-center border-2 border-fuchsia-500/70;
        }
        
        /* Prize Puzzle */
        .prize-item {
            @apply bg-gray-800 p-4 rounded-lg text-center cursor-pointer border-2 border-gray-700 hover:border-fuchsia-500 transition-all;
        }
        
        /* Versus Puzzle */
        .combo-btn {
            @apply w-12 h-12 bg-gray-700 text-white font-bold rounded-full flex items-center justify-center shadow-lg hover:bg-gray-600 transition-all text-2xl;
        }
        #combo-display {
            @apply h-10 bg-gray-900 border border-gray-700 rounded-lg p-2 text-center text-lg text-fuchsia-400 font-pixel tracking-widest;
        }
        
        .clue-input {
            @apply w-8 h-8 bg-gray-900 border-2 border-fuchsia-500 text-green-400 rounded-md text-center text-2xl font-pixel focus:outline-none focus:ring-2 focus:ring-cyan-400;
            caret-color: #4ade80; /* Neon green cursor */
            text-shadow: 0 0 5px #4ade80;
        }

        .pixel-art-container {
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            background-color: #374151; /* gray-700 */
        }

        .pixel-art-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* NEW: Blinking animation for the easter egg button */
        @keyframes blink {
            50% { opacity: 0.6; box-shadow: 0 0 15px #f0f; }
        }
        .blinking-button {
            animation: blink 1s linear infinite;
            @apply !bg-fuchsia-600/80 !border-fuchsia-400;
        }

    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="main-container" class="w-full max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-5 gap-6 transition-opacity duration-1000">

        <div class="md:col-span-3 bg-black/80 backdrop-blur-sm rounded-lg shadow-2xl overflow-hidden border-2 border-cyan-500/50" style="box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);">
            
            <div id="view-start" class="view p-8 md:p-12 active">
                <h1 class="font-pixel text-4xl md:text-5xl font-bold text-cyan-400 mb-4 text-center" style="text-shadow: 0 0 10px #0ff;">Game Over at Ace's Arcade</h1>
                <p class="text-lg text-gray-300 mb-8 text-center">At 'The Pixel Palace', the town's most popular 90s arcade, owner 'Ace' Hargrave has been found murdered in his back office.</p>
                <p class="text-gray-400 mb-10 text-center">As the detectives, you've been called to investigate. The arcade is locked down. You must find 4 clues to unlock the office safe and find the killer.</p>
                <div class="flex justify-center">
                    <button onclick="showView('view-hub')" class="btn-mystery text-2xl">Press Start</button>
                </div>
            </div>

            <div id="view-hub" class="view p-8 md:p-12">
                <h2 class="font-pixel text-3xl font-bold text-cyan-400 mb-6" style="text-shadow: 0 0 10px #0ff;">The Arcade Floor</h2>
                <p class="text-gray-300 mb-8">You stand on the main arcade floor. The suspects are milling about. Where do you want to go?</p>
                <div id="clue-log" class="mb-6 p-4 bg-gray-900/70 rounded-lg border border-fuchsia-500/50">
                    <h4 class="font-pixel text-lg text-fuchsia-400 mb-2">My Clues:</h4>
                    <div class="flex justify-center space-x-2">
                        <input type="text" id="clue-input-1" maxlength="1" class="clue-input">
                        <input type="text" id="clue-input-2" maxlength="1" class="clue-input">
                        <input type="text" id="clue-input-3" maxlength="1" class="clue-input">
                        <input type="text" id="clue-input-4" maxlength="1" class="clue-input">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="showView('view-scene')" class="btn-mystery-sm">Examine the Office (Crime Scene)</button>
                    <button onclick="showView('view-room-prize')" class="btn-mystery-sm">Go to Prize Counter</button>
                    <button onclick="showView('view-room-repair')" class="btn-mystery-sm">Go to Repair Shop</button>
                    <button onclick="showView('view-room-versus')" class="btn-mystery-sm">Go to Versus Corner</button>
                    <button onclick="showView('view-room-breakroom')" class="btn-mystery-sm">Go to Staff Breakroom</button>
                    <button onclick="showView('view-interviews')" class="btn-mystery-sm">Talk to Suspects</button>
                    <button onclick="tryToAccuse()" class="btn-mystery-sm">Make an Accusation</button>
                </div>
            </div>

            <div id="view-interviews" class="view p-8 md:p-12">
                <h2 class="font-pixel text-3xl font-bold text-cyan-400 mb-6" style="text-shadow: 0 0 10px #0ff;">Talk to Suspects</h2>
                <p class="text-gray-300 mb-8">Who do you want to speak to?</p>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="w-32 h-32 mx-auto mb-2 bg-gray-800 rounded-lg overflow-hidden border-4 border-fuchsia-500 pixel-art-container"><img src="https://raw.githubusercontent.com/jDigiexam/halloween2025/main/trisha.png" alt="Trisha" class="w-full h-full object-cover"></div>
                        <button onclick="showInterview('trisha')" class="btn-mystery-sm w-full">Trisha</button>
                    </div>
                    <div class="text-center">
                        <div class="w-32 h-32 mx-auto mb-2 bg-gray-800 rounded-lg overflow-hidden border-4 border-fuchsia-500 pixel-art-container"><img src="https://raw.githubusercontent.com/jDigiexam/halloween2025/main/lacey.png" alt="Lacey" class="w-full h-full object-cover"></div>
                        <button onclick="showInterview('lacey')" class="btn-mystery-sm w-full">Lacey</button>
                    </div>
                    <div class="text-center">
                        <div class="w-32 h-32 mx-auto mb-2 bg-gray-800 rounded-lg overflow-hidden border-4 border-fuchsia-500 pixel-art-container"><img src="https://raw.githubusercontent.com/jDigiexam/halloween2025/main/doc.png" alt="Doc" class="w-full h-full object-cover"></div>
                        <button onclick="showInterview('doc')" class="btn-mystery-sm w-full">'Doc' Shaw</button>
                    </div>
                    <div class="text-center">
                        <div class="w-32 h-32 mx-auto mb-2 bg-gray-800 rounded-lg overflow-hidden border-4 border-fuchsia-500 pixel-art-container"><img src="https://raw.githubusercontent.com/jDigiexam/halloween2025/main/stan.png" alt="Stan" class="w-full h-full object-cover"></div>
                        <button onclick="showInterview('stan')" class="btn-mystery-sm w-full">Stan</button>
                    </div>
                    <div class="text-center">
                        <div class="w-32 h-32 mx-auto mb-2 bg-gray-800 rounded-lg overflow-hidden border-4 border-fuchsia-500 pixel-art-container"><img src="https://raw.githubusercontent.com/jDigiexam/halloween2025/main/liz.png" alt="Liz" class="w-full h-full object-cover"></div>
                        <button onclick="showInterview('liz')" class="btn-mystery-sm w-full">Liz</button>
                    </div>
                </div>
                <button onclick="showView('view-hub')" class="btn-mystery-sm mt-8">Back to Arcade Floor</button>
            </div>
            
            <div id="view-scene" class="view p-8 md:p-12">
                <h2 class="font-pixel text-3xl font-bold text-cyan-400 mb-6" style="text-shadow: 0 0 10px #0ff;">The Crime Scene: The Back Office</h2>
                <p class="text-gray-300 mb-6">The office is cluttered. On the floor, you see a spilled bag of prize tokens and 'Ace' Hargrave's body. Nearby lies a bloody shard of plexiglass.</p>
                <p class="text-gray-300 mb-6">Under the desk is a large, heavy safe, locked with a 4-digit keypad. You'll need to find the combination.</p>
                <div id="clue-locked" class="bg-gray-800 p-6 rounded-lg border border-gray-700">
                    <p class="text-gray-300 mb-4">A 4-digit combination is required:</p>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="safe-code" placeholder="Enter 4-digit code..." maxlength="4" class="flex-grow bg-gray-900 border border-gray-600 text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-fuchsia-500 font-pixel">
                        <button onclick="checkSafeCode()" class="btn-mystery">Unlock</button>
                    </div>
                </div>
                <div id="clue-unlocked" class="hidden bg-green-900/50 border border-green-700 p-6 rounded-lg mt-6">
                    <h3 class="font-bold text-xl text-green-300 mb-2">Safe Unlocked!</h3>
                    <p class="text-green-200">Inside the safe, you find a legal contract. It's a draft of Ace's will, leaving 'The Pixel Palace' *entirely* to his niece, <strong>Trisha</strong>. A handwritten note in the margin reads: "Make sure there's a clause specifically excluding Lacey C. from any ownership, ever."</p>
                </div>
                <button onclick="showView('view-hub')" class="btn-mystery-sm mt-8">Back to Arcade Floor</button>
            </div>

            <div id="view-room-prize" class="view p-8 md:p-12">
                <h2 class="font-pixel text-3xl font-bold text-cyan-400 mb-6" style="text-shadow: 0 0 10px #0ff;">Prize Counter</h2>
                <p class="text-gray-300 mb-6">Liz is nervously sorting tickets. On the counter is a small riddle card next to a display of top prizes.</p>
                <p class="text-fuchsia-400 italic text-lg mb-6 text-center">"I have a spine but no bones, and many leaves but I am not a tree. I can be a good friend or a worst enemy. What am I?"</p>
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="prize-item" onclick="checkPrizePuzzle(this, false)"><span class="text-4xl">üéà</span><p>Balloon</p></div>
                    <div class="prize-item" onclick="checkPrizePuzzle(this, false)"><span class="text-4xl">üß∏</span><p>Teddy Bear</p></div>
                    <div class="prize-item" onclick="checkPrizePuzzle(this, true)"><span class="text-4xl">üìñ</span><p>Book</p></div>
                    <div class="prize-item" onclick="checkPrizePuzzle(this, false)"><span class="text-4xl">üëÑ</span><p>Wax Lips</p></div>
                    <div class="prize-item" onclick="checkPrizePuzzle(this, false)"><span class="text-4xl">ü§ñ</span><p>Toy Robot</p></div>
                </div>
                <button onclick="showView('view-hub')" class="btn-mystery-sm mt-8">Back to Arcade Floor</button>
            </div>

            <div id="view-room-repair" class="view p-8 md:p-12">
                <h2 class="font-pixel text-3xl font-bold text-cyan-400 mb-6" style="text-shadow: 0 0 10px #0ff;">Repair Shop</h2>
                <p class="text-gray-300 mb-6">'Doc's shop is a mess. On his workbench is a custom power supply unit with 4 dip switches. A note says: "Set to 3 Amps (Binary)."</p>
                <div class="flex justify-center space-x-4 my-8 p-4 bg-gray-800 rounded-lg">
                    <button id="switch1" class="btn-mystery-sm bg-red-600/80 border-red-400 w-20" onclick="toggleSwitchBtn(this, 1)">OFF</button>
                    <button id="switch2" class="btn-mystery-sm bg-red-600/80 border-red-400 w-20" onclick="toggleSwitchBtn(this, 2)">OFF</button>
                    <button id="switch3" class="btn-mystery-sm bg-red-600/80 border-red-400 w-20" onclick="toggleSwitchBtn(this, 3)">OFF</button>
                    <button id="switch4" class="btn-mystery-sm bg-red-600/80 border-red-400 w-20" onclick="toggleSwitchBtn(this, 4)">OFF</button>
                </div>
                <div class="flex justify-center"><button onclick="checkRepairPuzzle()" class="btn-mystery-sm">Check Switches</button></div>
                <button onclick="showView('view-hub')" class="btn-mystery-sm mt-8">Back to Arcade Floor</button>
            </div>

            <div id="view-room-versus" class="view p-8 md:p-12">
                <h2 class="font-pixel text-3xl font-bold text-cyan-400 mb-6" style="text-shadow: 0 0 10px #0ff;">Versus Corner</h2>
                <p class="text-gray-300 mb-6">Trisha is practicing combos. The 'How to Play' screen on an old fighting game shows a "Secret Combo" with 8 moves, but they are scratched out. "Try it if you want, newb."</p>
                <div id="combo-display" class="mb-4"></div>
                <div class="grid grid-cols-3 gap-2 max-w-xs mx-auto mb-6">
                    <div></div><button class="combo-btn" onclick="enterCombo('U')">üîº</button><div></div>
                    <button class="combo-btn" onclick="enterCombo('L')">‚óÄÔ∏è</button>
                    <button class="combo-btn" onclick="enterCombo('D')">üîΩ</button>
                    <button class="combo-btn" onclick="enterCombo('R')">‚ñ∂Ô∏è</button>
                </div>
                <button onclick="showView('view-hub')" class="btn-mystery-sm mt-8">Back to Arcade Floor</button>
            </div>

            <div id="view-room-breakroom" class="view p-8 md:p-12">
                <h2 class="font-pixel text-3xl font-bold text-cyan-400 mb-6" style="text-shadow: 0 0 10px #0ff;">Staff Breakroom</h2>
                <p class="text-gray-300 mb-6">
                    Lacey's jacket is slung over a chair. You check the pocket and find a folded bar napkin from 'The Neon Poodle' lounge. A heart is doodled on it with 'Ace &lt;3' written inside.
                </p>
                <p class="text-fuchsia-400 italic text-lg mb-6 text-center">
                    "Meet me at (IV + VI) / II AM"
                </p>
                <p class="text-gray-300 mb-6">
                    The ink is slightly smeared, as if from a tear. You look at a digital clock on the wall, its display flickering. Maybe you can set it to the right time?
                </p>
                <div class="flex justify-center items-center space-x-2 my-8">
                    <span id="clock-hours" class="text-6xl font-pixel text-gray-500 transition-colors">12</span>
                    <span class="text-6xl font-pixel text-gray-500 transition-colors">:</span>
                    <span id="clock-minutes" class="text-6xl font-pixel text-gray-500 transition-colors">00</span>
                </div>
                <div id="clock-controls" class="flex justify-center space-x-4">
                    <button onclick="adjustTime('hour')" class="btn-mystery-sm">Hour +</button>
                    <button onclick="adjustTime('minute')" class="btn-mystery-sm">Minute +</button>
                    <button onclick="checkClockSolution()" class="btn-mystery-sm !bg-fuchsia-600/80 !border-fuchsia-400 hover:!bg-fuchsia-500">Set Time</button>
                </div>
                <button onclick="showView('view-hub')" class="btn-mystery-sm mt-8">Back to Arcade Floor</button>
            </div>

            <div id="view-accuse" class="view p-8 md:p-12">
                <h2 class="font-pixel text-3xl font-bold text-cyan-400 mb-6" style="text-shadow: 0 0 10px #0ff;">Make Your Accusation</h2>
                <p class="text-gray-300 mb-8">You've reviewed the evidence. Who do you believe is the killer?</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="showSolution(true, 'You accuse Lacey. She breaks down. \'He promised me! We were supposed to be partners, 50/50. I... I really cared for him, you know? I thought he felt the same. Then... he was just going to give it all to that *brat* Trisha and write me off! I found the contract draft in the safe. I confronted him. He laughed. I... I just snapped.\' Case Closed.')" class="btn-mystery-sm">Lacey Collins</button>
                    <button onclick="showSolution(false, 'You accuse Trisha. She\'s furious. \'What?! He was giving me the arcade! I had everything I wanted! You\'re wrong!\'')" class="btn-mystery-sm">Trisha Hargrave</button>
                    <button onclick="showSolution(false, 'You accuse \'Doc\' Shaw. He denies it. Despite his constant complaining, no solid evidence ties him to the murder.')" class="btn-mystery-sm">'Doc' Shaw</button>
                    <button onclick="showSolution(false, 'Stan Thompson scoffs. His alibi holds up, and there is no evidence linking him to the crime.')" class="btn-mystery-sm">Stan "the man" Thompson</button>
                    <button onclick="showSolution(false, 'Liz Harding is confused by the accusation. She was just a witness.')" class="btn-mystery-sm">Liz Harding</button>
                </div>
                <button onclick="showView('view-hub')" class="btn-mystery-sm mt-8">Back to Arcade Floor</button>
            </div>
        </div>

        <div id="dialogue-panel" class="md:col-span-2 bg-black/80 backdrop-blur-sm rounded-lg shadow-2xl overflow-hidden border-2 border-fuchsia-500/50 p-6 hidden flex-col" style="box-shadow: 0 0 25px rgba(255, 0, 255, 0.3);">
        </div>

    </div>

    <div id="solution-modal" class="modal hidden opacity-0">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 id="solution-title" class="font-pixel text-2xl font-bold text-fuchsia-400 mb-4"></h3>
            <p id="solution-text" class="text-gray-300 mb-6"></p>
            <button id="solution-button" class="btn-mystery-sm">Close</button>
        </div>
    </div>
    
<script>
    let currentView = 'view-start';
    let isSafeUnlocked = false;
    
    // --- DIALOGUES & STATES ---
    let interviewState = { 'trisha': 0, 'lacey': 0, 'doc': 0, 'stan': 0, 'liz': 0 };
    const dialogues = {
        'trisha': { name: "Trisha Hargrave", imgSrc: "https://raw.githubusercontent.com/jDigiexam/halloween2025/main/trisha.png", lines: ["He was finally going to listen to me! I thought... I thought he was going to give me the arcade. But he spent *so* much time with 'Doc' lately. I was worried he'd listen to that old fossil and keep this place a museum!", "Look, I'm nervous, okay? This place is my future. If Doc convinced him to not upgrade to a LAN hall, I... I don't know what I'd do. But I didn't kill him."] },
        'lacey': { name: "Lacey Collins", imgSrc: "https://raw.githubusercontent.com/jDigiexam/halloween2025/main/lacey.png", lines: ["I... I can't believe he's gone. We were... close. He told me he was leaving the arcade to Trisha, to his *family*. I just... I just wanted us to run it together. But he said I wasn't 'family.'", "He promised me we'd be partners. 50/50. He was just stringing me along. I gave him everything... and he was just going to toss me aside for that brat."] },
        'doc': { name: "'Doc' Shaw", imgSrc: "https://raw.githubusercontent.com/jDigiexam/halloween2025/main/doc.png", lines: ["Heard Ace and Lacey arguing up a storm last night. She was yelling about 'getting what she deserved'. Sounded nasty. Couldn't have been me, I was... fixing this board!", "That cashier, Liz... she's a weird one. Always sneaking out back. Comes back covered in gray and black fur. What's that about? Me? I'm just... busy. Building... uh... *fixing* something new."] },
        'stan': { name: "Stan 'the man' Thompson", imgSrc: "https://raw.githubusercontent.com/jDigiexam/halloween2025/main/stan.png", lines: ["Liz Harding works for me, yeah. She's my girl. She told me Ace was going to sell, but then changed his mind to give it to his bratty niece. Messed up my plans to buy it.", "Between you and me, Liz has... cash problems. Big time. Always donating to those animal charities. I know for a fact she was skimming from Ace's registers. Maybe he found out?"] },
        'liz': { name: "Liz Harding", imgSrc: "https://raw.githubusercontent.com/jDigiexam/halloween2025/main/liz.png", lines: ["I... I've been working for Stan, okay? Just for extra cash! I heard Lacey and Ace yelling. She... she said 'If I can't have this place, no one can!' I was scared.", "That 'Doc' is a creep! Always locked in his shop. I think he's an alcoholic, and he *hates* animals. He's always yelling at me! The fur? Oh... I... I feed the raccoons out back. They're my friends."] }
    };

    // --- DIALOGUE PANEL LOGIC ---
    const dialoguePanel = document.getElementById('dialogue-panel');
    let typingTimeout;

    function displayMessage(title, text, imgSrc, type = 'default', buttonText = 'Close', buttonAction = null) {
        clearTimeout(typingTimeout);
        dialoguePanel.innerHTML = '';
        dialoguePanel.style.display = 'flex';
        dialoguePanel.classList.remove('hidden');

        const titleEl = document.createElement('h3');
        const portraitContainer = document.createElement('div');
        const textEl = document.createElement('p');
        const actionBtn = document.createElement('button');

        titleEl.className = 'font-pixel text-2xl font-bold mb-4';
        titleEl.textContent = title;

        if (imgSrc) {
            portraitContainer.className = 'w-24 h-24 mb-4 bg-gray-800 rounded-lg overflow-hidden border-4 border-fuchsia-500 pixel-art-container self-center';
            portraitContainer.innerHTML = `<img src="${imgSrc}" alt="${title}" class="w-full h-full object-cover">`;
        }
        textEl.className = 'text-lg mb-auto';
        
        actionBtn.className = 'btn-mystery-sm mt-6';
        actionBtn.textContent = buttonText;
        if (buttonAction) {
            actionBtn.onclick = buttonAction;
        } else {
            actionBtn.onclick = () => { dialoguePanel.style.display = 'none'; };
        }

        let textColor = 'text-cyan-300', textShadow = '0 0 5px #0ff';
        if (type === 'error') { textColor = 'text-red-400'; textShadow = '0 0 7px #f44'; } 
        else if (type === 'success') { textColor = 'text-green-400'; textShadow = '0 0 7px #4f4'; } 
        else if (type === 'interview') { textColor = 'text-fuchsia-300'; textShadow = '0 0 7px #f0f'; }

        [titleEl, textEl].forEach(el => {
            el.classList.add(textColor);
            el.style.textShadow = textShadow;
        });

        dialoguePanel.appendChild(titleEl);
        if (imgSrc) dialoguePanel.appendChild(portraitContainer);
        dialoguePanel.appendChild(textEl);
        dialoguePanel.appendChild(actionBtn);

        let i = 0;
        textEl.innerHTML = '';
        function typeWriter() {
            if (i < text.length) {
                textEl.innerHTML += text.charAt(i);
                i++;
                typingTimeout = setTimeout(typeWriter, 20);
            }
        }
        typeWriter();
    }
    
    function showInterview(suspect) {
        const suspectData = dialogues[suspect];
        if (!suspectData) return;
        const dialogue = (interviewState[suspect] === 0) ? suspectData.lines[0] : suspectData.lines[1];
        if (interviewState[suspect] === 0) interviewState[suspect]++;
        displayMessage(`Interview: ${suspectData.name}`, dialogue, suspectData.imgSrc, 'interview');
    }

    // --- VIEW NAVIGATION ---
    function showView(viewId) {
        document.getElementById(currentView)?.classList.remove('active');
        document.getElementById(viewId)?.classList.add('active');
        currentView = viewId;
    }
    
    function tryToAccuse() {
        if (isSafeUnlocked) {
            showView('view-accuse');
        } else {
            displayMessage('Not Yet...', 'You need more evidence. The contents of the safe in the back office might hold the key to the motive.', null, 'error');
        }
    }

    // --- PUZZLE LOGIC ---
    function checkSafeCode() {
        const answer = document.getElementById('safe-code').value.trim();
        const correctCode = "1358";
        if (answer === correctCode) {
            isSafeUnlocked = true;
            document.getElementById('clue-locked').style.display = 'none';
            document.getElementById('clue-unlocked').style.display = 'block';
            displayMessage('Success!', 'The safe clicks open. You found a crucial document!', null, 'success'); 
        } else {
            displayMessage('Locked', 'The safe remains firmly shut. Wrong code. (Hint: Try sorting the clues you found.)', null, 'error');
        }
    }

    function checkPrizePuzzle(selectedElement, isCorrect) {
        if (document.querySelectorAll('.prize-item.border-green-500').length > 0) return;
        if (isCorrect) {
            selectedElement.classList.add('border-green-500');
            document.querySelectorAll('.prize-item').forEach(el => el.onclick = null);
            displayMessage('Clue Found!', "You point to the book. Liz nods. 'Oh... right.' You look at the price tag for the book. It's 800 tickets. The first digit, '8', is circled.", null, 'success');
        } else {
            displayMessage('Wrong Prize', 'That\'s not it. Try again.', null, 'error');
        }
    }

    let switchStates = [0, 0, 0, 0];
    function toggleSwitchBtn(btn, num) {
        let index = num - 1;
        switchStates[index] = 1 - switchStates[index];
        btn.textContent = switchStates[index] === 1 ? 'ON' : 'OFF';
        btn.classList.toggle('bg-red-600/80', switchStates[index] === 0);
        btn.classList.toggle('border-red-400', switchStates[index] === 0);
        btn.classList.toggle('bg-green-600/80', switchStates[index] === 1);
        btn.classList.toggle('border-green-400', switchStates[index] === 1);
    }
    
    function checkRepairPuzzle() {
        if (document.querySelector('#view-room-repair button[onclick="checkRepairPuzzle()"][disabled]')) return;
        if (switchStates.join('') === '0011') {
            document.querySelectorAll('#view-room-repair > div button').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('btn-disabled');
            });
            displayMessage('Clue Found!', "You flip the last two switches to ON. The power supply hums to life. A small LED on the board, previously unlit, glows, revealing the binary for 3.", null, 'success');
        } else {
            displayMessage('No Effect', 'The power supply buzzes, but nothing happens. Wrong combination.', null, 'error');
        }
    }

    let comboInput = "";
    function enterCombo(move) {
        if (document.querySelectorAll('.combo-btn[disabled]').length > 0) return;
        comboInput += move;
        document.getElementById('combo-display').textContent = comboInput;
        if (comboInput.length >= 8) {
            if (comboInput === "UUDDLRLR") {
                document.querySelectorAll('.combo-btn').forEach(btn => btn.disabled = true);
                displayMessage('Clue Found!', "You punch in the classic 8-button code. The screen flashes! 'WINNER!' appears. On the winner screen, a small message appears in the corner: 'Ready Player 1.'", null, 'success');
            } else {
                displayMessage('Wrong Combo', 'Trisha laughs. "Not even close!"', null, 'error');
            }
            comboInput = "";
            setTimeout(() => { if (document.querySelectorAll('.combo-btn[disabled]').length === 0) document.getElementById('combo-display').textContent = ""; }, 1000);
        }
    }
    
    let clockHour = 12, clockMinute = 0, breakroomPuzzleSolved = false;
    function adjustTime(part) {
        if (breakroomPuzzleSolved) return;
        if (part === 'hour') clockHour = (clockHour % 12) + 1;
        else if (part === 'minute') clockMinute = (clockMinute + 10) % 60;
        updateClockDisplay();
    }
    function updateClockDisplay() {
        document.getElementById('clock-hours').textContent = String(clockHour).padStart(2, '0');
        document.getElementById('clock-minutes').textContent = String(clockMinute).padStart(2, '0');
    }

    function checkClockSolution() {
        if (breakroomPuzzleSolved) return;
        if (clockHour === 5 && clockMinute === 0) {
            breakroomPuzzleSolved = true;
            document.querySelectorAll('#view-room-breakroom .text-6xl').forEach(el => el.classList.replace('text-gray-500', 'text-green-400'));
            document.querySelectorAll('#clock-controls button').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('btn-disabled');
            });
            displayMessage('Clue Found!', "As you set the clock to 5:00, the display stops flickering and glows a steady green. The time must have been 5 AM.", null, 'success');
        } else {
            displayMessage('No Change', "Nothing happens. That doesn't seem to be the right time.", null, 'error');
        }
    }
    
    // --- FINAL SOLUTION LOGIC ---
    const solutionModal = document.getElementById('solution-modal');
    function showSolution(isCorrect, explanationText) {
        if (isCorrect) {
            // Fade out main game container
            document.getElementById('main-container').style.opacity = '0';
            
            // After fade, change background
            setTimeout(() => {
                document.body.style.backgroundImage = "url('https://raw.githubusercontent.com/jDigiexam/halloween2025/main/easter%20egg.png')";
            }, 1000); // Match transition duration

            const title = solutionModal.querySelector('#solution-title');
            const text = solutionModal.querySelector('#solution-text');
            const button = solutionModal.querySelector('#solution-button');

            title.textContent = "Case Solved!";
            title.className = 'font-pixel text-2xl font-bold mb-4 text-green-400';
            text.innerHTML = explanationText;
            
            button.textContent = "Doc's Dungeon";
            button.className = 'btn-mystery-sm blinking-button'; // Add blinking class
            button.onclick = () => {
                window.open('https://jdigiexam.github.io/docs-dungeon/', '_blank');
            };

            solutionModal.classList.remove('hidden');
            setTimeout(() => solutionModal.classList.remove('opacity-0'), 10);
        } else {
            const fullText = `You accused the wrong person. ${explanationText}`;
            const returnAction = () => {
                dialoguePanel.style.display = 'none';
                showView('view-hub');
            };
            displayMessage('Game Over', fullText, null, 'error', 'Return to Investigation', returnAction);
        }
    }
    
    function closeSolutionModal() {
        solutionModal.classList.add('opacity-0');
        setTimeout(() => solutionModal.classList.add('hidden'), 300);
    }

    // --- GAME RESTART ---
    function restartGame() {
        window.location.reload();
    }
</script>
</body>
</html>
